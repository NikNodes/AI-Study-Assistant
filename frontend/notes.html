<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Notes | AI Study Assistant</title>
<link rel="stylesheet" href="notes.css">
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="header-content">
    <div class="header-left">
      <h1>ğŸ“ AI Study Assistant</h1>
    </div>
    <nav class="header-nav">
      <a href="dashboard.html">Dashboard</a>
      <a href="upload.html">Upload Notes</a>
      <a href="ai-chat.html">Ask AI</a>
      <a href="quiz.html">Quiz</a>
      <button class="logout-btn" onclick="goBack()">Back</button>
    </nav>
  </div>
</header>

<!-- Main Content -->
<main class="main-container">
  <div class="notes-header">
    <div class="header-info">
      <h2>ğŸ“š My Study Notes</h2>
      <p>Manage all your uploaded study materials in one place</p>
    </div>
    <a href="upload.html" class="upload-link">
      <button class="add-note-btn">+ Upload New Note</button>
    </a>
  </div>

  <!-- Notes Grid -->
  <div class="notes-list" id="notesList">
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
  </div>
</main>

<script>
const userId = localStorage.getItem("userId");

if (!userId) {
  alert("Please login first");
  window.location.href = "dashboard.html";
} else {
  fetch(`http://localhost:5000/api/notes/user/${userId}`)
    .then(res => {
      if (!res.ok) {
        throw new Error(`Fetch failed: ${res.status}`);
      }
      return res.json();
    })
    .then(notes => {
      const list = document.getElementById("notesList");
      list.innerHTML = "";

      if (notes.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <h3>No Notes Yet</h3>
            <p>You haven't uploaded any study notes yet. Start by uploading your first note!</p>
            <a href="upload.html"><button class="empty-btn">Upload Your First Note</button></a>
          </div>
        `;
        return;
      }

      notes.forEach((note, index) => {
        const div = document.createElement("div");
        div.className = "note-card";
        div.style.animationDelay = (index * 0.1) + "s";
        const fileName = note.originalname;
        const fileExtension = fileName.split('.').pop().toUpperCase();
        const fileIcon = getFileIcon(fileExtension);
        
        div.innerHTML = `
          <div class="note-content">
            <div class="note-icon">${fileIcon}</div>
            <div class="note-info">
              <h3>${fileName}</h3>
              <p class="note-date">Uploaded on ${new Date(note.uploadedAt).toLocaleDateString()}</p>
            </div>
          </div>
          <div class="note-actions">
            <a href="http://localhost:5000/uploads/${note.filename}" target="_blank">
              <button class="view-btn">View</button>
            </a>
            <button class="download-btn" onclick="downloadNote('${note.filename}', '${fileName}')">Download</button>
          </div>
        `;
        list.appendChild(div);
      });
    })
    .catch(error => {
      console.error("Fetch error:", error);
      document.getElementById("notesList").innerHTML = `
        <div class="error-state">
          <div class="error-icon">âš ï¸</div>
          <h3>Error Loading Notes</h3>
          <p>${error.message}</p>
          <button onclick="location.reload()">Try Again</button>
        </div>
      `;
    });
}

function getFileIcon(extension) {
  const icons = {
    'PDF': 'ğŸ“•',
    'TXT': 'ğŸ“„',
    'DOC': 'ğŸ“˜',
    'DOCX': 'ğŸ“—',
    'PPT': 'ğŸ¯',
    'PPTX': 'ğŸ¯'
  };
  return icons[extension] || 'ğŸ“‹';
}

function downloadNote(filename, originalName) {
  const link = document.createElement('a');
  link.href = `http://localhost:5000/uploads/${filename}`;
  link.download = originalName;
  link.click();
}

function goBack() {
  window.location.href = "dashboard.html";
}
</script>

</body>
</html>

</body>
</html>
